<!--ユーザーごとの投稿画面-->
<!--user情報のupdete成功メッセージ-->
<p class="text-success"><%= flash[:user_update] %></p>

    <div class ="col-md-3">

      <!--新規投稿の失敗　バリデーション-->
      <%= render "layouts/error",model:@newbook %>

      <%= render "users/profile" ,user:@user %>

      <!--チャットボタン-->
      <% if current_user.following?(@user) && @user.following?(current_user) %>
        <% unless @user.id==current_user.id %>
          <% if @isRoom == true %>
          	<%= link_to "チャットを始める",room_path(@roomId)%>
          <% else %>
          	<!--Roomの作成　RoomとEntry2つのモデルにデータを送る-->
          	<%= form_with model: @room, local: true do |f| %>
          		<%= fields_for @entry do |e| %>
          			<!--@entryのuser_idに@user.idを入れる-->
          			<%= e.hidden_field :user_id, value: @user.id %>
          		<%end%>
          		<%= f.submit "新しくチャットを始める",class:"text-primary"%>
          		<%#= link_to "新しくチャットを始める", rooms_path,method: :submit %>
          		<!--link_toだと何度もチャットを作成してしまう-->
          	<% end %>
          <%end%>
        <%end%>
      <%end%>

      <!--book新規投稿-->
      <%= render "books/newbook",newbook:@newbook %>
    </div>

    <div class="col-md-8 pt-3 offset-md-1">

      <h1>Books</h1>
        <table class="table table-hover table-inverse" >
          <thead>
            <tr>
              <th style="width: "></th>
              <th style="width: ">Title</th>
              <th style="width: ">Opinion</th>
              <th colspan="2"></th>
            </tr>
          </thead>

          <tbody>
            <% @books.each do |book| %>
              <tr>
                <td><%=link_to user_path(@user.id) do %>
                  <%=attachment_image_tag @user,:profile_image,:fill,50,50,format: 'jpeg', fallback: "no_image.jpg",size:"50x50" %>
                  <%end%>
                </td>
                <td><%= link_to book.title, book_path(book.id)%></td>
                <td><%=book.body %></td>

                <!--コメント数カウント-->
                <td>コメント数:<%= book.book_comments.count %></td>
                <td>閲覧数:<%= book.view_counts.count %></td>
              </tr>
            <%end%>
          </tbody>
        </table>

        <h3 class="mt-5">投稿数の前日比・前週比</h3>
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>今日の投稿数</th>
              <th>前日の投稿数</th>
              <th>前日比</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><%= @today_books.count %></td>
              <td><%= @yesterday_books.count %></td>
              <td>
                <%if @yesterday_books.count == 0%>
                  前日の投稿はありません
                <%else%>
                  <% @the_day_before = @today_books.count / @yesterday_books.count.to_f %>
                  <%= (@the_day_before *100).round %>%
                <%end%>
              </td>
            </tr>
          <tbody>
        </table>

        <table class="table table-bordered">
          <thead>
            <tr>
              <th>今週の投稿数</th>
              <th>前週の投稿数</th>
              <th>前週比</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><%= @this_week_books.count %></td>
              <td><%= @last_week_books.count %></td>
              <td>
                <%if @last_week_books.count == 0%>
                  先週の投稿はありません
                <%else%>
                  <% @the_week_before = @this_week_books.count / @last_week_books.count.to_f %>
                  <%= (@the_week_before*100).round %>
                <%end%>
              </td>
            </tr>
          <tbody>
        </table>
    </div>
